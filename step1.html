<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maze Adventures - step1</title>
    <link rel="stylesheet" href="step1.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbit&family=Paytone+One&family=Pixelify+Sans:wght@400..700&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <link rel="preconnect" href="src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff') format('woff');">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>

<body>
    <div id="q">
        <div id="q-container">
            <img src="img/q.png" alt="">
            <a href="#" id="d-link">
                <img src="img/d.png" alt="" id="d">
            </a>
            <span id="typing-text"><br>
                &nbsp;아기오리는 강에 있는 물고기들을 구경하다가 그만 가족들을 잃어버리고 혼자남게 되었어요. <br>
                지금부터 아기오리가 가족들을 찾아갈 수 있게 도와주세요! <br><br>
                &nbsp;(단, 각 단계에서 아이템을 꼭 전부 수집해야합니다.)</span>
        </div>
    </div>



    <div class="frame">
        <div class="text">
            <p>LEVEL 1</p>
            <div id="item-count">0/3</div>
            <a href="home.html" id="home-button"><img src="img/home1_btn.png" alt="Home"></a>
            <a href="#" id="reset-button"><img src="img/reset1_btn.png" alt="reset"></a>
        </div>
        <div class="board"></div>
        <div id="item" class="item"></div>
        <div id="message"></div>
        <div id="no" style="display: none;">
            <p>아직 아이템을 다 먹지 않았어요!</p>
        </div>
    </div>



    <audio id="item-sound" src="img/sound1.mp3" preload="auto"></audio>
    <audio id="item-click" src="img/click.mp3" preload="auto"></audio>
    <audio id="step-sound" src="img/step_sound.mp3"></audio>
    <audio id="destination-sound" src="img/success.mp3" preload="auto"></audio>
    <audio src="img/main.mp3" autoplay loop></audio>


    <div class="overlay"></div>

    <script>
        let maze = [
            [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 0, 1, 4, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 4, 1],
            [1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1],
            [1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1],
            [1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1],
            [1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1],
            [1, 0, 0, 0, 1, 0, 1, 1, 4, 1, 1, 0, 1, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 1]
        ]

        let player = [0, 1]
        let gameWon = false

        
        let itemPositions = [
            [1, 3],
            [6, 8],
            [1, 14]
        ];

        let itemCount = 0;


        const ROWS = 8
        const COLS = 16

        const EMPTY = 0
        const WALL = 1
        const PLAYER = 2
        const EXIT = 3
        const ITEM = 4

        const DOWN = 40
        const UP = 38
        const LEFT = 37
        const RIGHT = 39



        window.onload = () => {
            createBoard()
            renderMaze()
            showItems();
        }

        const createBoard = () => {
            for (let row = 0; row < ROWS; row++) {
                for (let col = 0; col < COLS; col++) {
                    const block = document.createElement('div')
                    block.id = `id-${col}-${row}`
                    document.querySelector(".board").appendChild(block)
                }
            }
        }

        const renderMaze = () => {
            for (let row = 0; row < ROWS; row++) {
                for (let col = 0; col < COLS; col++) {
                    let itemClass = ''
                    switch (maze[row][col]) {
                        case PLAYER:
                            itemClass = 'player'; break
                        case WALL:
                            itemClass = 'wall'; break
                        case EXIT:
                            itemClass = 'exit'; break
                        default:
                            itemClass = 'empty'
                    }
                    const id = `#id-${col}-${row}`
                    const element = document.querySelector(id);
                    if (element) {
                        element.className = `block ${itemClass}`;
                    }
                }
            }
            const id = `#id-${player[1]}-${player[0]}`
            const playerElement = document.querySelector(id);
            if (playerElement) {
                playerElement.className = 'block player';
            }
        }


        window.onkeydown = (event) => {
            if (gameWon) return

            let direction = 0
            switch (event.keyCode) {
                case DOWN:
                    direction = DOWN; break
                case UP:
                    direction = UP; break
                case LEFT:
                    direction = LEFT; break
                case RIGHT:
                    direction = RIGHT; break
                default:
                    direction = 0
            }
            if (direction !== 0) {
                changePlayerPos(direction)
                eatItem();
            }
        }

        const changePlayerPos = (direction) => {
            let [dy, dx] = [0, 0]
            switch (direction) {
                case UP:
                    dy = -1; break
                case RIGHT:
                    dx = 1; break
                case LEFT:
                    dx = -1; break
                case DOWN:
                    dy = 1; break
                default:
                    return
            }

            const x = player[1] + dx
            const y = player[0] + dy

            if (x >= 0 && x < COLS && y >= 0 && y < ROWS && maze[y][x] !== WALL) {
                player = [y, x];
                renderMaze();

                const stepSound = document.getElementById('step-sound');
                stepSound.play();


                if (maze[y][x] === EXIT) {
                    if (itemCount === 3) {
                        gameWon = true;

                        const destinationSound = document.getElementById('destination-sound');
                        destinationSound.play();
                        setTimeout(() => {
                            const confirmation = confirm('Congratulations! You reached the exit! Do you want to go to the next level?');
                            if (confirmation) {
                                window.location.href = 'step2.html';
                            }
                        }, 100);
                    } else {
                        showNoMessage();
                    }
                }
            }
        }

        const showNoMessage = () => {
            const noMessage = document.getElementById('no');
            noMessage.style.display = 'block'; 
            setTimeout(() => {
                noMessage.style.display = 'none';
            }, 2000);
        };



        const renderItem = (position) => {
            const id = `#id-${position[1]}-${position[0]}`;
            const block = document.querySelector(id);
            if (block) {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item';
                itemDiv.style.backgroundImage = "url('img/item2.png')";
                block.appendChild(itemDiv);
            }
        };

        const renderItems = () => {
            itemPositions.forEach(position => {
                renderItem(position);
            });
        };

        const showItems = () => {
            itemPositions.forEach(position => {
                showItem(position);
            });
        };

        const showItem = (position) => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item';
            itemDiv.style.backgroundImage = "url('img/item2.png')";
            const id = `#id-${position[1]}-${position[0]}`;
            document.querySelector(id).appendChild(itemDiv);
        };

        renderItems();

        const eatItem = () => {
            itemPositions.forEach((position, index) => {
                if (player[0] === position[0] && player[1] === position[1]) {
                    maze[position[0]][position[1]] = EMPTY;

                    const id = `#id-${position[1]}-${position[0]}`;
                    const itemDiv = document.querySelector(id);
                    if (itemDiv) {
                        itemDiv.style.opacity = '0';
                    }

                    setTimeout(() => {
                        document.getElementById('message').innerText = '';
                    }, 2000);

                    itemPositions.splice(index, 1);

                    itemCount++;
                    document.getElementById('item-count').innerText = `${itemCount}/3`;

                    const itemSound = document.getElementById('item-sound');
                    itemSound.play();

                    if (itemCount !== 3) {
                        showNoMessage();
                    }
                }
            });
        };



        document.getElementById('reset-button').addEventListener('click', function (event) {
            event.preventDefault();
            resetPlayer();
        });

        function resetPlayer() {
    player = [0, 1];

    itemPositions = [
        [1, 3],
        [6, 8],
        [1, 14]
    ];

    itemCount = 0;

    renderMaze();

    document.getElementById('item-count').innerText = `${itemCount}/3`;


    document.querySelectorAll('.item').forEach(item => item.remove());


    renderItems(); 
}


        const itemClick = document.getElementById('item-click');

        document.getElementById('reset-button').addEventListener('click', function (event) {
            event.preventDefault(); 

            itemClick.play();
        });

        document.getElementById('home-button').addEventListener('click', function (event) {
            itemClick.play();
        });

        document.getElementById('home-button').addEventListener('click', function (event) {
            event.preventDefault(); 

            const homeSound = new Audio('audio/home_sound.mp3');
            homeSound.play();

            setTimeout(function () {
                window.location.href = 'home.html';
            }, 300); 
        });



        const text = document.getElementById('typing-text').textContent.trim();
        document.getElementById('typing-text').textContent = '';

        let index = 0;
        function typeText() {
            document.getElementById('typing-text').textContent += text[index];
            index++;
            if (index < text.length) {
                setTimeout(typeText, 50);
            }
        }

        typeText();


        document.getElementById('d-link').addEventListener('click', function (event) {
            event.preventDefault(); 
            document.getElementById('q').classList.add('hide');
        });




    </script>
</body>

</html>